<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <style>
      /* Configuration de la Page A4 */
      @page {
        size: A4;
        margin: 2cm;
        @top-center {
          content: element(header-banner);
          width: 100%;
        }
        @bottom-right {
          content: counter(page);
        }
      }
      
      /* Page de Couverture : Pas de numéro de page */
      @page: first {
        margin: 0;
        @top-center {
          content: none;
        }
        @bottom-right {
          content: '';
        }
      }
      
      body {
        font-family: 'Times New Roman', serif;
        font-size: 10pt;
        line-height: 1.5;
      }
      
      .page-header {
        position: running(header-banner);
        width: 100%;
        background: #1a5a8e;
        color: white;
        display: flex;
        padding: 10px;
        justify-content: space-between;
        font-size: 8pt;
        font-weight: bold;
      }
      
      h1 {
        color: black;
        background: #85d6e1;
        font-size: 14pt;
        width: 100%;
        margin: 0;
      }
      
      h2 {
        color: black;
        background: #85d6e1;
        font-size: 12pt;
      }
      
      img {
        width: 100%;
        margin: auto;
      }
      
      /* --- STYLES DU SOMMAIRE AUTOMATIQUE --- */
      .toc-entry {
        display: flex;
        align-items: flex-end;
        margin-bottom: 5px;
      }
      .toc-entry a {
        text-decoration: none;
        color: black;
        width: 100%;
        display: flex;
      }
      /* Les points ..... entre le titre et le numéro */
      .toc-entry a::after {
        content: leader('.') target-counter(attr(href), page);
        margin-left: 5px;
        font-weight: bold;
      }
      
      .figure-entry {
        display: flex;
        align-items: flex-start;
        margin-bottom: 8px;
      }
      
      .figure-entry a {
        text-decoration: none;
        color: black;
        width: 100%;
        display: flex;
      }
      
      .figure-entry a::after {
        content: leader('.') target-counter(attr(href), page);
        margin-left: 5px;
        font-weight: bold;
      }
      
      /* Sauts de page obligatoires */
      .page-break {
        break-before: always;
      }
      /* --- STYLE DE LA COUVERTURE --- */
      @page: first {
        margin: 1cm; /* Marges plus petites pour la couverture */
        background-image: url('/static/images/fond_filigrane.png'); /* Optionnel: si vous avez un fond */
        background-size: cover;
        @bottom-right {
          content: '';
        } /* Pas de numéro de page */
      }
      
      .cover-page {
        font-family: 'Arial', sans-serif;
        color: #000;
        text-align: center;
      }
      
      /* En-tête Administratif (3 colonnes) */
      .header-section {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
        font-size: 10px; /* Police petite pour l'admin */
      }
      
      .header-left {
        text-align: center;
      }
      .header-right {
        text-align: center;
      }
      .header-center {
        text-align: center;
      }
      
      .ministry-title {
        font-weight: bold;
        text-transform: uppercase;
        margin-top: 5px;
      }
      
      /* Le Logo des Armoiries */
      .armoiries-img {
        width: 100px; /* Ajustez selon la qualité de votre image */
        height: auto;
      }
      
      /* L'illustration centrale (Le graphique Budget) */
      .main-illustration {
        margin: 40px auto;
        width: 80%;
        text-align: center;
      }
      .main-illustration img {
        max-width: 100%;
        object-fit: cover;
      }
      
      /* Le Bloc Titre Principal */
      .title-box {
        border: 3px solid #2e74b5; /* Cadre bleu comme souvent au MINEPAT */
        padding: 20px;
        margin: 20px auto;
        width: 90%;
        background-color: rgba(255, 255, 255, 0.9);
      }
      
      .title-main {
        font-family: 'Times New Roman', Times, serif;
        font-size: 14pt;
        font-style: italic;
        font-weight: 600; /* légèrement bold pour imiter le rendu institutionnel */
        color: black;
        text-align: center;
        text-transform: uppercase;
        letter-spacing: -0.5px; /* reproduction fidèle du léger serrage */
        line-height: 1.1;
        margin: 20px 40px;
      }
      
      .title-sub {
        font-size: 14pt;
        font-weight: bold;
        color: #333;
      }
      
      .report-date {
        margin-top: 50px;
        font-size: 16pt;
        font-weight: bold;
        color: #e36c0a; /* Une couleur d'accentuation (orange/rouge) */
      }
    </style>
  </head>
  <body>
    <div class="page-header">
      <div>CADRE DE CONCERTATION POUR LE SUIVI DU BIP DU MINEPAT</div>
      <div class="page-header-subtitle">{{ rapport.mois }} {{ rapport.annee }}</div>
    </div>

    <div class="cover-page">
      <div class="header-section">
        <table style="width: 100%; text-align: center; margin-bottom: 20px; font-family: 'Arial', sans-serif;">
          <tr>
            <!-- Bloc gauche -->
            <td style="width: 42%; vertical-align: top; text-transform: uppercase;">
              <div>
                <strong>RÉPUBLIQUE DU CAMEROUN</strong>
              </div>
              <div>
                <i>Paix – Travail – Patrie</i>
              </div>
              <div>**************</div>
              <div>
                <strong>MINISTÈRE DE L’ÉCONOMIE, DE LA PLANIFICATION ET DE L’AMÉNAGEMENT DU TERRITOIRE</strong>
              </div>
              <div>**************</div>
              <div>
                <strong>SECRÉTARIAT GÉNÉRAL</strong>
              </div>
              <div>**************</div>
              <div>
                <strong>DIRECTION DES AFFAIRES GENERALES</strong>
              </div>
              <div>**************</div>
              <div>
                <strong>SOUS-DIRECTION DU BUDGET</strong>
              </div>
              <div>**************</div>
              <div>
                <strong>SERVICE DU BUDGET</strong>
              </div>
              <div>**************</div>
            </td>

            <td style="width: 16%; vertical-align: top;">
              <img src="{{ base_url }}media/images/armoiries_cameroun.png" style="width: 80px; margin: 0 auto;" alt="Armoiries du Cameroun" />
            </td>

            <td style="width: 42%; vertical-align: top; text-transform: uppercase;">
              <div>
                <strong>REPUBLIC OF CAMEROON</strong>
              </div>
              <div>
                <i>Peace – Work – Fatherland</i>
              </div>
              <div>**************</div>
              <div>
                <strong>MINISTRY OF THE ECONOMY, PLANNING AND REGIONAL DEVELOPMENT</strong>
              </div>
              <div>**************</div>
              <div>
                <strong>GENERAL SECRETARIAT</strong>
              </div>
              <div>**************</div>
              <div>
                <strong>DEPARTMENT OF GENERAL AFFAIRS</strong>
              </div>
              <div>**************</div>
              <div>
                <strong>SUB-DEPARTMENT OF THE BUDGET</strong>
              </div>
              <div>**************</div>
              <div>
                <strong>BUDGET SERVICE</strong>
              </div>
              <div>**************</div>
            </td>
          </tr>
        </table>
      </div>

      <div class="title-box">
        <div class="title-main">{{ rapport.titre }}</div>
      </div>

      <div class="main-illustration">
        <img src="/media/images/budget.jpg" alt="Illustration Budget" />
      </div>

      <div class="report-date">{{ rapport.mois }} {{ rapport.annee }}</div>
    </div>

    <div class="page-break">
      <h1 style="text-align: center;">Sommaire</h1>
      {% for section in toc %}
        <div class="toc-entry main-section">
          <a href="#{{ section.id }}">{{ section.title }}</a>
        </div>
        {% for subsection in section.subsections %}
          <div class="toc-entry subsection">
            <a href="#{{ subsection.id }}">{{ subsection.title }}</a>
          </div>
        {% endfor %}
      {% endfor %}
    </div>

    {% if figures %}
      <div class="page-break">
        <h1 style="text-align: center;">Liste des Figures</h1>
        {% for figure in figures %}
          <div class="figure-entry">
            <a href="#{{ figure.id }}">{{ figure.caption }}</a>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="page-break">
      <h1 style="text-align: center;">Liste des Tableaux</h1>
      <p>
        <i>(Sera généré automatiquement via une boucle similaire au sommaire)</i>
      </p>
    </div>

    {% for section in sections %}
      {% if section.processed_content %}
        <div class="page-break" id="{{ section.id }}">
          <h1>{{ section.title }}</h1>
          {{ section.processed_content|safe }}
        </div>
      {% endif %}
    {% endfor %}
  </body>
</html>
